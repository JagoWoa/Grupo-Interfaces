<app-header></app-header>

<section
  class="relative min-h-screen flex items-center justify-center px-8 py-12 bg-cover bg-center"
  style="background-image: url('/doctor.jpeg')"
>
  <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

  <div class="relative z-10 w-full max-w-md">
    <div class="bg-white rounded-2xl shadow-2xl p-8 space-y-6 card-reset">
      <div class="text-center space-y-2">
        <h1 class="text-3xl font-bold text-black">Restablecer contraseÃ±a</h1>
        <p class="text-gray-600">Ingresa tu nueva contraseÃ±a para acceder a tu cuenta.</p>
      </div>

      @if (isCheckingToken) {
      <div class="flex items-center justify-center py-8">
        <span class="animate-spin text-4xl">ğŸ”„</span>
        <span class="ml-3 text-gray-600">Verificando enlace...</span>
      </div>
      } @if (!isCheckingToken && !isValidToken) {
      <div
        class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm flex items-start gap-2"
      >
        <span
          >El enlace de recuperaciÃ³n ha expirado o es invÃ¡lido. Por favor, solicita uno nuevo.</span
        >
      </div>
      <div class="text-center">
        <a routerLink="/recuperar-contrasena" class="text-[#004b98] hover:underline font-semibold">
          Solicitar nuevo enlace
        </a>
      </div>
      } @if (!isCheckingToken && isValidToken) { @if (errorMessage) {
      <div
        class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm flex items-start gap-2"
      >
        <span>{{ errorMessage }}</span>
      </div>
      } @if (successMessage) {
      <div
        class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm flex items-start gap-2"
      >
        <span>{{ successMessage }}</span>
      </div>
      } @if (!successMessage) {
      <form (ngSubmit)="onSubmit()" class="space-y-5">
        <!-- Nueva contraseÃ±a -->
        <div class="space-y-2">
          <label
            for="newPassword"
            class="block text-sm font-medium text-gray-700 flex items-center gap-2"
          >
            Nueva contraseÃ±a
          </label>
          <div class="relative">
            <input
              [type]="showPassword ? 'text' : 'password'"
              id="newPassword"
              name="newPassword"
              [(ngModel)]="newPassword"
              placeholder="MÃ­nimo 8 caracteres"
              required
              class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg text-black focus:ring-2 focus:ring-blue-500 placeholder:text-gray-400"
            />
            <button
              type="button"
              (click)="togglePasswordVisibility()"
              class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
              [title]="showPassword ? 'Ocultar contraseÃ±a' : 'Mostrar contraseÃ±a'"
            >
              ğŸ‘ï¸
            </button>
          </div>
        </div>

        <!-- Confirmar contraseÃ±a -->
        <div class="space-y-2">
          <label
            for="confirmPassword"
            class="block text-sm font-medium text-gray-700 flex items-center gap-2"
          >
            Confirmar contraseÃ±a
          </label>
          <div class="relative">
            <input
              [type]="showConfirmPassword ? 'text' : 'password'"
              id="confirmPassword"
              name="confirmPassword"
              [(ngModel)]="confirmPassword"
              placeholder="Repite tu nueva contraseÃ±a"
              required
              class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg text-black focus:ring-2 focus:ring-blue-500 placeholder:text-gray-400"
            />
            <button
              type="button"
              (click)="toggleConfirmPasswordVisibility()"
              class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
              [title]="showConfirmPassword ? 'Ocultar contraseÃ±a' : 'Mostrar contraseÃ±a'"
            >
              ğŸ‘ï¸
            </button>
          </div>
        </div>

        <button
          type="submit"
          [disabled]="isLoading"
          class="w-full bg-[#004b98] text-white py-3 rounded-lg font-semibold hover:bg-[#004bbc] transition-all shadow-lg disabled:opacity-50 flex items-center justify-center gap-2"
        >
          @if (isLoading) {
          <span class="animate-spin">ğŸ”„</span> Actualizando... } @else { Actualizar contraseÃ±a }
        </button>
      </form>
      } }

      <div class="text-center text-sm">
        <a routerLink="/login" class="text-[#004b98] hover:underline font-semibold"
          >Volver al inicio de sesiÃ³n</a
        >
      </div>
    </div>
  </div>
</section>

<app-footer></app-footer>
